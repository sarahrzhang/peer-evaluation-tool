<p id="notice"><%= notice %></p>

<h1>Groups</h1>
<% if current_instructor %>
<h2>You are in Course <%= get_current_course.id %>: <%= get_current_course.course_name %></h2>
<% end %>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Group name</th>
      <th>Course Name</th>
      <th>Course ID</th>
      <th>Instructor</th>
      <th>Students</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <% if current_instructor %>
  <tbody>
    <% @groups.each do |group| %>
    <% if group.course.id== get_current_course.id %>
      <tr>
        <td><%= link_to group.group_name, group %></td>
        <td><%= Course.find(group.course_id).course_name %></td>
        <td><%= group.course_id %></td>
        <td><%= Instructor.find(Course.find(group.course_id).instructor_id).last_name %></td>
        <td>
        <%group.students.each do |stud| %>
        <%= stud.email %> <%= stud.last_name %><br>
        <% end %>
        </td>
        <td><%= link_to 'Show', group %></td>
        <% if current_instructor %>
        <td><%= link_to 'Edit', edit_group_path(group) %></td>
        <td><%= link_to 'Destroy', group, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
      <% elsif group.course.id == get_current_course.id && group.students.any? { |current| current.email == current_student.email } %>
        <tr>
          <td><%= link_to group.group_name, group %></td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
  <% end %>
  <% if current_student %>
  <tbody>
    <% @groups.each do |group| %>
    <% if group.students.include? current_student %>
      <tr>
        <td><%= link_to group.group_name, group %></td>
        <td><%= Course.find(group.course_id).course_name %></td>
        <td><%= group.course_id %></td>
        <td><%= Instructor.find(Course.find(group.course_id).instructor_id).last_name %></td>
        <td>
        <%group.students.each do |stud| %>
        <%= stud.email %><br>
        <% end %>
        </td>
        <td><%= link_to 'Show', group %></td>
      </tr>

    <% end %>
    <% end %>
  </tbody>
  <% end %>
</table>

<br>

<% if current_instructor %>
<%= link_to 'New Group', new_group_path %>
<% end %>
